<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nurse Portal | Sneha Health</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --navy: #05152e;
  --navy-2: #0a2144;
  --navy-3: #0f2d5c;
  --blue: #1565c0;
  --blue-bright: #1e88e5;
  --blue-light: #42a5f5;
  --cyan: #00b4d8;
  --cyan-light: #48cae4;
  --teal: #00897b;
  --surface: #0d1f3c;
  --surface-2: #112547;
  --card: #132a52;
  --card-2: #163060;
  --border: rgba(30,136,229,0.18);
  --border-bright: rgba(66,165,245,0.35);
  --text: #e8f0fe;
  --text-2: #90a8d0;
  --text-3: #5a7aaa;
  --green: #00c853;
  --amber: #ffab00;
  --red: #ff1744;
  --purple: #7c4dff;
  --sidebar-w: 260px;
  --radius: 14px;
  --radius-sm: 8px;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Sora',sans-serif; background:var(--navy); color:var(--text); min-height:100vh; overflow-x:hidden; }
::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border-bright); border-radius:4px; }

/* ‚îÄ‚îÄ OVERLAY ‚îÄ‚îÄ */
.overlay { position:fixed; inset:0; z-index:9999; background:linear-gradient(135deg,#020c1e,#051535,#071a3e); display:flex; align-items:center; justify-content:center; }
.overlay-card { background:var(--card); border:1px solid var(--border-bright); border-radius:24px; padding:2.5rem 2rem; width:100%; max-width:420px; box-shadow:0 32px 80px rgba(0,0,0,0.6); text-align:center; }
.overlay-logo { width:64px; height:64px; background:linear-gradient(135deg,var(--teal),var(--cyan)); border-radius:18px; display:flex; align-items:center; justify-content:center; margin:0 auto 1.5rem; box-shadow:0 8px 32px rgba(0,137,123,0.5); }
.overlay-logo svg { width:28px; height:28px; }
.overlay-card h2 { font-size:1.4rem; font-weight:700; margin-bottom:0.5rem; }
.overlay-card p { color:var(--text-2); font-size:0.875rem; }
.login-form { margin-top:1.75rem; text-align:left; }
.login-form label { font-size:0.75rem; font-weight:600; color:var(--text-2); text-transform:uppercase; letter-spacing:0.08em; display:block; margin-bottom:0.4rem; }
.login-form input { width:100%; padding:0.75rem 1rem; background:var(--navy-3); border:1px solid var(--border); border-radius:var(--radius-sm); color:var(--text); font-family:inherit; font-size:0.9rem; margin-bottom:1rem; transition:border-color 0.2s; }
.login-form input:focus { outline:none; border-color:var(--teal); }
.btn-primary { width:100%; padding:0.85rem; background:linear-gradient(135deg,var(--teal),var(--cyan)); color:#fff; border:none; border-radius:var(--radius-sm); font-family:inherit; font-size:0.9rem; font-weight:600; cursor:pointer; transition:all 0.2s; box-shadow:0 4px 16px rgba(0,137,123,0.4); }
.btn-primary:hover { transform:translateY(-1px); box-shadow:0 8px 24px rgba(0,137,123,0.5); }
.diag { margin-top:1.5rem; background:rgba(0,0,0,0.3); border-radius:8px; padding:0.5rem 0.75rem; max-height:80px; overflow-y:auto; font-family:'JetBrains Mono',monospace; font-size:0.7rem; color:var(--text-3); text-align:left; }
.picker-list { max-height:180px; overflow-y:auto; border:1px solid var(--border); border-radius:var(--radius-sm); margin-top:1rem; }
.picker-item { padding:0.75rem 1rem; cursor:pointer; border-bottom:1px solid var(--border); font-size:0.85rem; transition:background 0.15s; }
.picker-item:hover { background:var(--navy-3); color:var(--cyan); }
.picker-item .pid { font-size:0.72rem; color:var(--text-3); font-family:monospace; }
.hidden { display:none !important; }

/* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
.app-shell { display:flex; min-height:100vh; }
.sidebar { width:var(--sidebar-w); background:linear-gradient(180deg,var(--navy-2),var(--navy)); border-right:1px solid var(--border); display:flex; flex-direction:column; position:fixed; height:100vh; z-index:100; overflow-y:auto; }
.sidebar-header { padding:1.5rem 1.25rem; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:0.75rem; }
.logo-icon { width:40px; height:40px; background:linear-gradient(135deg,var(--teal),var(--cyan)); border-radius:12px; display:flex; align-items:center; justify-content:center; flex-shrink:0; box-shadow:0 4px 12px rgba(0,137,123,0.4); }
.logo-icon svg { width:20px; height:20px; }
.logo-text { font-size:1rem; font-weight:700; }
.logo-sub { font-size:0.7rem; color:var(--text-3); }
.sidebar-nav { flex:1; padding:1rem 0.75rem; }
.nav-group-label { font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:0.12em; color:var(--text-3); padding:0.75rem 0.5rem 0.4rem; }
.nav-item { display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:var(--radius-sm); cursor:pointer; transition:all 0.18s; font-size:0.85rem; font-weight:500; color:var(--text-2); margin-bottom:2px; }
.nav-item:hover { background:rgba(0,180,216,0.08); color:var(--text); }
.nav-item.active { background:linear-gradient(90deg,rgba(0,137,123,0.22),rgba(0,180,216,0.12)); color:var(--cyan); border-left:2.5px solid var(--teal); }
.nav-icon { width:18px; height:18px; flex-shrink:0; opacity:0.8; }
.sidebar-footer { padding:1rem; border-top:1px solid var(--border); }
.user-chip { display:flex; align-items:center; gap:0.6rem; padding:0.6rem; background:var(--surface-2); border-radius:10px; }
.user-avatar { width:32px; height:32px; background:linear-gradient(135deg,var(--teal),var(--cyan)); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:700; flex-shrink:0; }
.user-name { font-size:0.8rem; font-weight:600; color:var(--text); line-height:1.2; }
.user-role { font-size:0.68rem; color:var(--text-3); }
.logout-btn { margin-top:0.5rem; width:100%; padding:0.5rem; background:transparent; border:1px solid var(--border); border-radius:var(--radius-sm); color:var(--text-2); font-family:inherit; font-size:0.78rem; cursor:pointer; transition:all 0.2s; }
.logout-btn:hover { border-color:var(--red); color:var(--red); }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { margin-left:var(--sidebar-w); flex:1; display:flex; flex-direction:column; }
.topbar { padding:1rem 2rem; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:1rem; background:rgba(5,21,46,0.95); backdrop-filter:blur(12px); position:sticky; top:0; z-index:50; }
.topbar-title { font-size:1.1rem; font-weight:700; }
.topbar-sub { font-size:0.78rem; color:var(--text-3); margin-top:1px; }
.topbar-actions { margin-left:auto; display:flex; gap:0.5rem; }
.btn-sm { padding:0.45rem 0.9rem; font-size:0.78rem; font-weight:600; border-radius:6px; border:none; cursor:pointer; font-family:inherit; transition:all 0.18s; }
.btn-sm.primary { background:linear-gradient(135deg,var(--teal),var(--cyan)); color:#fff; }
.btn-sm.primary:hover { transform:translateY(-1px); }
.btn-sm.outline { background:transparent; border:1px solid var(--border-bright); color:var(--text-2); }
.btn-sm.outline:hover { border-color:var(--cyan); color:var(--cyan); }
.content-body { padding:1.5rem 2rem; max-width:1200px; }

/* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
.section { display:none; animation:fadeUp 0.28s ease; }
.section.active { display:block; }
@keyframes fadeUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:none; } }

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stats-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:1rem; margin-bottom:1.5rem; }
.stat-card { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:1.25rem; border-top:3px solid transparent; }
.stat-card.teal { border-top-color:var(--teal); }
.stat-card.cyan { border-top-color:var(--cyan); }
.stat-card.green { border-top-color:var(--green); }
.stat-card.amber { border-top-color:var(--amber); }
.stat-card.purple { border-top-color:var(--purple); }
.stat-label { font-size:0.7rem; font-weight:600; text-transform:uppercase; letter-spacing:0.1em; color:var(--text-3); }
.stat-value { font-size:2rem; font-weight:700; margin:0.35rem 0 0; font-family:'JetBrains Mono',monospace; }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; margin-bottom:1.25rem; }
.card-header { display:flex; align-items:center; justify-content:space-between; padding:1rem 1.25rem; border-bottom:1px solid var(--border); }
.card-title { font-size:0.95rem; font-weight:700; }
.card-body { padding:0; }
.section-actions { display:flex; gap:0.5rem; }

/* ‚îÄ‚îÄ DATA ROWS ‚îÄ‚îÄ */
.data-row { display:flex; align-items:center; gap:1rem; padding:0.8rem 1.25rem; border-bottom:1px solid var(--border); cursor:pointer; transition:all 0.15s; position:relative; }
.data-row:last-child { border-bottom:none; }
.data-row:hover { background:rgba(0,180,216,0.06); padding-left:1.5rem; }
.data-row:hover::before { content:''; position:absolute; left:0; top:0; bottom:0; width:3px; background:var(--teal); border-radius:0 2px 2px 0; }
.row-main { flex:1; min-width:0; }
.row-title { font-size:0.875rem; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.row-sub { font-size:0.75rem; color:var(--text-3); font-family:'JetBrains Mono',monospace; margin-top:2px; }
.row-meta { display:flex; flex-direction:column; align-items:flex-end; gap:4px; flex-shrink:0; }

/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.badge { font-size:0.68rem; font-weight:600; padding:0.25rem 0.5rem; border-radius:4px; }
.badge-success { background:rgba(0,200,83,0.15); color:#69db7c; }
.badge-warn { background:rgba(255,171,0,0.15); color:var(--amber); }
.badge-error { background:rgba(255,23,68,0.12); color:#ff6b6b; }
.badge-info { background:rgba(66,165,245,0.12); color:var(--blue-light); }
.badge-cyan { background:rgba(0,180,216,0.15); color:var(--cyan); }
.badge-teal { background:rgba(0,137,123,0.15); color:#4db6ac; }
.count-badge { background:var(--navy-3); color:var(--cyan); font-size:0.7rem; font-weight:700; padding:0.15rem 0.5rem; border-radius:10px; }
.empty-state { padding:2.5rem; text-align:center; color:var(--text-3); font-size:0.875rem; }
.emoji { display:block; font-size:2rem; margin-bottom:0.75rem; }

/* ‚îÄ‚îÄ VITALS QUICK ENTRY ‚îÄ‚îÄ */
.vitals-form { padding:1.25rem; display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:0.75rem; }
.vitals-form .field-group { display:flex; flex-direction:column; gap:0.3rem; }
.vitals-form label { font-size:0.72rem; font-weight:600; color:var(--text-2); text-transform:uppercase; letter-spacing:0.06em; }
.vitals-form input, .vitals-form select { padding:0.6rem 0.8rem; background:var(--navy-3); border:1px solid var(--border); border-radius:6px; color:var(--text); font-family:'JetBrains Mono',monospace; font-size:0.85rem; width:100%; }
.vitals-form input:focus, .vitals-form select:focus { outline:none; border-color:var(--teal); }
.vitals-form-footer { padding:0 1.25rem 1.25rem; display:flex; gap:0.5rem; }
.vitals-patient-search { padding:1.25rem 1.25rem 0; display:flex; gap:0.5rem; }
.vitals-patient-search input { flex:1; padding:0.65rem 0.9rem; background:var(--navy-3); border:1px solid var(--border); border-radius:6px; color:var(--text); font-family:inherit; font-size:0.875rem; }
.vitals-patient-search input:focus { outline:none; border-color:var(--teal); }

/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
.profile-grid { display:grid; grid-template-columns:1fr 1fr; gap:0.75rem; padding:1.25rem; }
.profile-field { display:flex; flex-direction:column; gap:0.25rem; }
.profile-field .pf-label { font-size:0.68rem; font-weight:600; text-transform:uppercase; letter-spacing:0.1em; color:var(--text-3); }
.profile-field .pf-value { font-size:0.875rem; color:var(--text); font-family:'JetBrains Mono',monospace; }

/* ‚îÄ‚îÄ QUICK ACTIONS ‚îÄ‚îÄ */
.quick-actions { display:flex; gap:0.75rem; flex-wrap:wrap; margin-bottom:1.5rem; }
.qa-btn { padding:0.75rem 1.25rem; background:var(--card); border:1px solid var(--border); border-radius:10px; cursor:pointer; font-family:inherit; font-size:0.82rem; font-weight:600; color:var(--text-2); display:flex; align-items:center; gap:0.5rem; transition:all 0.18s; }
.qa-btn:hover { border-color:var(--teal); color:var(--cyan); background:rgba(0,137,123,0.08); transform:translateY(-1px); }
.qa-btn .qa-icon { font-size:1.1rem; }

@media (max-width:900px) {
  .sidebar { transform:translateX(-100%); transition:transform 0.3s; }
  .sidebar.open { transform:none; }
  .main { margin-left:0; }
  .stats-grid { grid-template-columns:repeat(2,1fr); }
  .profile-grid { grid-template-columns:1fr; }
  .vitals-form { grid-template-columns:1fr 1fr; }
}
</style>
</head>
<body>

<!-- LOGIN OVERLAY -->
<div class="overlay" id="overlay">
  <div class="overlay-card">
    <div class="overlay-logo">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
      </svg>
    </div>
    <h2>Nurse Portal</h2>
    <p>Sneha Health / Rena Rehabilitation Centre</p>
    <div id="login-ui">
      <div class="login-form">
        <label>Email</label>
        <input type="email" id="inp-email" placeholder="nurse@snehahealth.in" autocomplete="username">
        <label>Password</label>
        <input type="password" id="inp-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
        <button class="btn-primary" onclick="doLogin()">Sign In</button>
      </div>
    </div>
    <div id="picker-ui" class="hidden">
      <p style="margin-top:1rem;font-size:0.85rem;color:var(--amber);">Could not auto-detect your employee record. Please select:</p>
      <div class="picker-list" id="picker-list"></div>
    </div>
    <div class="diag" id="diag-log"></div>
  </div>
</div>

<!-- APP -->
<div class="app-shell hidden" id="app-shell">

  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </div>
      <div>
        <div class="logo-text">Sneha Health</div>
        <div class="logo-sub">Nurse Portal</div>
      </div>
    </div>

    <div class="sidebar-nav">
      <div class="nav-group-label">Overview</div>
      <div class="nav-item active" onclick="nav('dashboard')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Dashboard
      </div>
      <div class="nav-item" onclick="nav('profile')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
        My Profile
      </div>

      <div class="nav-group-label">Clinical</div>
      <div class="nav-item" onclick="nav('vitals')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Vital Signs
      </div>
      <div class="nav-item" onclick="nav('patients')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Patients
      </div>
      <div class="nav-item" onclick="nav('inpatient')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Inpatient Care
      </div>
      <div class="nav-item" onclick="nav('nursing-tasks')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
        Nursing Tasks
      </div>
      <div class="nav-item" onclick="nav('medication')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
        Medication Requests
      </div>
      <div class="nav-item" onclick="nav('service-req')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Service Requests
      </div>

      <div class="nav-group-label">HR</div>
      <div class="nav-item" onclick="nav('attendance')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Attendance
      </div>
      <div class="nav-item" onclick="nav('leave')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Leave
      </div>
      <div class="nav-item" onclick="nav('payroll')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        Payroll
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="user-chip">
        <div class="user-avatar" id="user-avatar">N</div>
        <div>
          <div class="user-name" id="user-name">Loading‚Ä¶</div>
          <div class="user-role">Nurse</div>
        </div>
      </div>
      <button class="logout-btn" onclick="doLogout()">Sign Out</button>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div>
        <div class="topbar-title" id="topbar-title">Dashboard</div>
        <div class="topbar-sub" id="topbar-sub">Welcome back</div>
      </div>
      <div class="topbar-actions">
        <button class="btn-sm primary" onclick="nav('vitals')">üìä Record Vitals</button>
        <button class="btn-sm outline" onclick="openERP('/app/patient-encounter/new')">+ Encounter</button>
      </div>
    </div>

    <div class="content-body">

      <!-- DASHBOARD -->
      <section id="section-dashboard" class="section active">
        <div class="quick-actions">
          <div class="qa-btn" onclick="nav('vitals')"><span class="qa-icon">üìä</span> Record Vitals</div>
          <div class="qa-btn" onclick="nav('nursing-tasks')"><span class="qa-icon">‚úÖ</span> Nursing Tasks</div>
          <div class="qa-btn" onclick="openERP('/app/inpatient-record/new')"><span class="qa-icon">üõèÔ∏è</span> New Inpatient</div>
          <div class="qa-btn" onclick="openERP('/app/attendance/new')"><span class="qa-icon">üïê</span> Mark Attendance</div>
        </div>
        <div class="stats-grid">
          <div class="stat-card teal"><div class="stat-label">Today's Vitals</div><div class="stat-value" id="stat-vitals">‚Äî</div></div>
          <div class="stat-card cyan"><div class="stat-label">Active Inpatients</div><div class="stat-value" id="stat-inpatients">‚Äî</div></div>
          <div class="stat-card green"><div class="stat-label">Pending Tasks</div><div class="stat-value" id="stat-tasks">‚Äî</div></div>
          <div class="stat-card amber"><div class="stat-label">Medication Req.</div><div class="stat-value" id="stat-medreq">‚Äî</div></div>
          <div class="stat-card purple"><div class="stat-label">Attendance</div><div class="stat-value" id="stat-att">‚Äî</div></div>
        </div>
        <div class="card">
          <div class="card-header"><h3 class="card-title">Recent Vital Signs</h3><button class="btn-sm primary" onclick="nav('vitals')">View All</button></div>
          <div class="card-body" id="dash-vitals"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
        <div class="card">
          <div class="card-header"><h3 class="card-title">Today's Nursing Tasks</h3><button class="btn-sm outline" onclick="nav('nursing-tasks')">View All</button></div>
          <div class="card-body" id="dash-tasks"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- PROFILE -->
      <section id="section-profile" class="section">
        <div class="card">
          <div class="card-header"><h3 class="card-title">Employee Profile</h3></div>
          <div id="profile-container"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- VITAL SIGNS -->
      <section id="section-vitals" class="section">
        <div class="card" style="margin-bottom:1.25rem;">
          <div class="card-header"><h3 class="card-title">Record Vital Signs</h3></div>
          <div class="vitals-patient-search">
            <input type="text" id="vitals-patient-inp" placeholder="Search patient name or ID‚Ä¶" oninput="searchPatientForVitals()">
          </div>
          <div id="vitals-patient-result" style="padding:0 1.25rem;"></div>
          <div class="vitals-form" id="vitals-form" style="margin-top:0.5rem;">
            <div class="field-group"><label>Temperature (¬∞F)</label><input type="number" id="v-temp" placeholder="98.6" step="0.1"></div>
            <div class="field-group"><label>Pulse (bpm)</label><input type="number" id="v-pulse" placeholder="72"></div>
            <div class="field-group"><label>Systolic BP</label><input type="number" id="v-bp-sys" placeholder="120"></div>
            <div class="field-group"><label>Diastolic BP</label><input type="number" id="v-bp-dia" placeholder="80"></div>
            <div class="field-group"><label>SpO2 (%)</label><input type="number" id="v-spo2" placeholder="98" min="0" max="100"></div>
            <div class="field-group"><label>Respiratory Rate</label><input type="number" id="v-rr" placeholder="16"></div>
            <div class="field-group"><label>Weight (kg)</label><input type="number" id="v-weight" placeholder="65" step="0.1"></div>
            <div class="field-group"><label>Height (cm)</label><input type="number" id="v-height" placeholder="165"></div>
          </div>
          <div class="vitals-form-footer">
            <button class="btn-sm primary" onclick="saveVitals()">üíæ Save Vitals</button>
            <button class="btn-sm outline" onclick="clearVitalsForm()">Clear</button>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:0.75rem;"><h3 class="card-title">Vitals History</h3><span class="count-badge" id="count-vitals">0</span></div>
            <button class="btn-sm outline" onclick="openERP('/app/vital-signs/new')">Open in ERP</button>
          </div>
          <div class="card-body" id="list-vitals"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- PATIENTS -->
      <section id="section-patients" class="section">
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:0.75rem;"><h3 class="card-title">Patient List</h3><span class="count-badge" id="count-patients">0</span></div>
            <button class="btn-sm primary" onclick="openERP('/app/patient/new')">+ New Patient</button>
          </div>
          <div class="card-body" id="list-patients"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- INPATIENT -->
      <section id="section-inpatient" class="section">
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:0.75rem;"><h3 class="card-title">Inpatient Records</h3><span class="count-badge" id="count-inpatient">0</span></div>
            <button class="btn-sm primary" onclick="openERP('/app/inpatient-record/new')">+ Admit Patient</button>
          </div>
          <div class="card-body" id="list-inpatient"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- NURSING TASKS -->
      <section id="section-nursing-tasks" class="section">
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:0.75rem;"><h3 class="card-title">Nursing Tasks</h3><span class="count-badge" id="count-nursing-tasks">0</span></div>
            <button class="btn-sm primary" onclick="openERP('/app/nursing-task/new')">+ New Task</button>
          </div>
          <div class="card-body" id="list-nursing-tasks"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- MEDICATION REQUESTS -->
      <section id="section-medication" class="section">
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:0.75rem;"><h3 class="card-title">Medication Requests</h3><span class="count-badge" id="count-medication">0</span></div>
            <button class="btn-sm outline" onclick="openERP('/app/medication-request/new')">+ New</button>
          </div>
          <div class="card-body" id="list-medication"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- SERVICE REQUESTS -->
      <section id="section-service-req" class="section">
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:0.75rem;"><h3 class="card-title">Service Requests</h3><span class="count-badge" id="count-service-req">0</span></div>
            <button class="btn-sm outline" onclick="openERP('/app/service-request/new')">+ New</button>
          </div>
          <div class="card-body" id="list-service-req"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- ATTENDANCE -->
      <section id="section-attendance" class="section">
        <div class="card">
          <div class="card-header"><h3 class="card-title">Attendance Record</h3><button class="btn-sm primary" onclick="openERP('/app/attendance/new')">+ Mark</button></div>
          <div class="card-body" id="list-attendance"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- LEAVE -->
      <section id="section-leave" class="section">
        <div class="card">
          <div class="card-header"><h3 class="card-title">Leave Applications</h3><button class="btn-sm primary" onclick="openERP('/app/leave-application/new')">+ Apply</button></div>
          <div class="card-body" id="list-leave"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

      <!-- PAYROLL -->
      <section id="section-payroll" class="section">
        <div class="card">
          <div class="card-header"><h3 class="card-title">Salary Slips</h3></div>
          <div class="card-body" id="list-payroll"><div class="empty-state">Loading‚Ä¶</div></div>
        </div>
      </section>

    </div>
  </main>
</div>

<script>
const BASE = window.location.origin;
let state = { user: null, employee: null, activeSection: 'dashboard' };
let vitalsPatient = null;
let vitalsPatientSearchTimer = null;

function log(msg, type='info') {
  const el = document.getElementById('diag-log');
  if (!el) return;
  const d = document.createElement('div');
  d.style.color = type==='error'?'#ff6b6b':type==='success'?'#69db7c':'#748ffc';
  d.textContent = (type==='error'?'‚úó':'‚úì')+' '+msg;
  el.appendChild(d); el.scrollTop = el.scrollHeight;
}

function badgeClass(s) {
  if (!s) return 'badge-info';
  const v = s.toLowerCase();
  if (['completed','present','approved','active','closed','submitted','paid','normal'].some(x=>v.includes(x))) return 'badge-success';
  if (['cancelled','rejected','absent'].some(x=>v.includes(x))) return 'badge-error';
  if (['pending','open','draft','waiting','scheduled'].some(x=>v.includes(x))) return 'badge-warn';
  return 'badge-info';
}

function fmt(str) {
  if (!str) return '‚Äî';
  if (str.match(/^\d{4}-\d{2}-\d{2}/)) return new Date(str).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
  return str;
}

function openERP(path) { window.open(BASE+path,'_blank'); }
function empty(msg='No records found.') { return `<div class="empty-state"><span class="emoji">üì≠</span>${msg}</div>`; }

async function api(resource, params={}) {
  const url = new URL(`${BASE}/api/resource/${encodeURIComponent(resource)}`);
  if (params.filters) url.searchParams.set('filters', JSON.stringify(params.filters));
  if (params.fields) url.searchParams.set('fields', JSON.stringify(params.fields));
  if (params.limit) url.searchParams.set('limit', params.limit);
  if (params.order_by) url.searchParams.set('order_by', params.order_by);
  try { const r = await fetch(url,{credentials:'include'}); if (r.ok) return (await r.json())?.data||[]; return null; } catch { return null; }
}

async function postApi(method, args={}) {
  try {
    const r = await fetch(`${BASE}/api/method/${method}`, {
      method:'POST', credentials:'include',
      headers:{'Content-Type':'application/json','X-Frappe-CSRF-Token': await getCsrfToken()},
      body: JSON.stringify(args)
    });
    return await r.json();
  } catch { return null; }
}

async function getCsrfToken() {
  try { const r = await fetch(`${BASE}/api/method/frappe.auth.get_logged_user`,{credentials:'include'}); return r.headers.get('X-Frappe-CSRF-Token')||''; } catch { return ''; }
}

async function initSession() {
  log('Initializing session‚Ä¶');
  try {
    const r = await fetch('/api/method/frappe.auth.get_logged_user');
    const user = (await r.json())?.message;
    if (!user || user==='Guest') { showLoginUI(); return; }
    state.user = user;
    log(`Session: ${user}`,'success');
    await runDiscovery();
  } catch { showLoginUI(); }
}

async function runDiscovery() {
  const emp = await api('Employee',{ filters:[['user_id','=',state.user]], fields:['name','employee_name','designation','department','cell_number','personal_email'] });
  if (emp?.length) { state.employee = emp[0]; log(`Employee: ${emp[0].name}`,'success'); }
  showApp();
  loadDashboard();
}

function showLoginUI() {
  document.getElementById('login-ui').classList.remove('hidden');
}

function showApp() {
  document.getElementById('overlay').classList.add('hidden');
  document.getElementById('app-shell').classList.remove('hidden');
  const name = state.employee?.employee_name || state.user;
  document.getElementById('user-name').textContent = name;
  document.getElementById('user-avatar').textContent = (name[0]||'N').toUpperCase();
  document.getElementById('topbar-sub').textContent = `Welcome back, ${name.split(' ')[0]}`;
}

async function doLogin() {
  const email = document.getElementById('inp-email').value;
  const pass = document.getElementById('inp-pass').value;
  if (!email||!pass) return;
  log('Signing in‚Ä¶');
  try {
    const r = await fetch('/api/method/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({usr:email,pwd:pass}),credentials:'include'});
    const d = await r.json();
    if (d.message==='Logged In') { state.user=email; log('Logged in','success'); await runDiscovery(); }
    else { log('Invalid credentials','error'); }
  } catch(e) { log('Login failed: '+e.message,'error'); }
}

async function doLogout() {
  await fetch('/api/method/logout',{method:'POST',credentials:'include'});
  location.reload();
}

const navTitles = {
  dashboard:'Dashboard', profile:'My Profile', vitals:'Vital Signs', patients:'Patients',
  inpatient:'Inpatient Care', 'nursing-tasks':'Nursing Tasks', medication:'Medication Requests',
  'service-req':'Service Requests', attendance:'Attendance', leave:'Leave Applications', payroll:'Payroll'
};

function nav(section) {
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const el = document.getElementById(`section-${section}`);
  if (el) el.classList.add('active');
  event?.currentTarget?.classList.add('active');
  state.activeSection = section;
  document.getElementById('topbar-title').textContent = navTitles[section]||section;
  loadSection(section);
}

function loadSection(section) {
  switch(section) {
    case 'dashboard': loadDashboard(); break;
    case 'profile': loadProfile(); break;
    case 'vitals': loadVitals(); break;
    case 'patients': loadPatients(); break;
    case 'inpatient': loadInpatient(); break;
    case 'nursing-tasks': loadNursingTasks(); break;
    case 'medication': loadMedication(); break;
    case 'service-req': loadServiceReq(); break;
    case 'attendance': loadAttendance(); break;
    case 'leave': loadLeave(); break;
    case 'payroll': loadPayroll(); break;
  }
}

async function loadDashboard() {
  const today = new Date().toISOString().split('T')[0];

  // Stats
  const [vitals, inpatients, medreq, att] = await Promise.all([
    api('Vital Signs',{filters:[['signs_date','=',today]],fields:['name'],limit:500}),
    api('Inpatient Record',{filters:[['status','in',['Admission Scheduled','Admitted']]],fields:['name'],limit:500}),
    api('Medication Request',{filters:[['status','in',['Draft','Pending']]],fields:['name'],limit:500}),
    api('Attendance',{filters:state.employee?[['employee','=',state.employee.name],['attendance_date','=',today]]:null,fields:['status'],limit:1}),
  ]);

  document.getElementById('stat-vitals').textContent = vitals?.length||0;
  document.getElementById('stat-inpatients').textContent = inpatients?.length||0;
  document.getElementById('stat-tasks').textContent = '‚Äî';
  document.getElementById('stat-medreq').textContent = medreq?.length||0;
  document.getElementById('stat-att').textContent = att?.[0]?.status||'‚Äî';

  // Recent vitals
  const rv = await api('Vital Signs',{fields:['name','patient','signs_date','temperature','pulse','bp_systolic','bp_diastolic','spo2'],order_by:'signs_date desc',limit:8});
  document.getElementById('dash-vitals').innerHTML = renderVitalRows(rv);

  // Nursing tasks (try common doctypes)
  for (const dt of ['Nursing Task','Patient Task']) {
    const tasks = await api(dt,{fields:['name','patient','status','creation'],order_by:'creation desc',limit:6});
    if (tasks?.length) {
      document.getElementById('dash-tasks').innerHTML = tasks.map(t=>`
        <div class="data-row" onclick="openERP('/app/${dt.toLowerCase().replace(' ','-')}/${t.name}')">
          <div class="row-main"><div class="row-title">${t.name}</div><div class="row-sub">${t.patient||'‚Äî'}</div></div>
          <div class="row-meta"><span class="badge ${badgeClass(t.status)}">${t.status||'‚Äî'}</span><span style="font-size:0.72rem;color:var(--text-3);font-family:monospace">${fmt(t.creation)}</span></div>
        </div>`).join('');
      document.getElementById('stat-tasks').textContent = tasks.length;
      break;
    }
  }
}

function renderVitalRows(vitals) {
  if (!vitals?.length) return empty('No vitals recorded today.');
  return vitals.map(v=>`
    <div class="data-row" onclick="openERP('/app/vital-signs/${v.name}')">
      <div class="row-main">
        <div class="row-title">${v.patient||'Unknown Patient'}</div>
        <div class="row-sub" style="font-family:'JetBrains Mono',monospace;font-size:0.72rem;">
          ${v.temperature?'üå°Ô∏è'+v.temperature+'¬∞F':''}${v.pulse?' ‚ù§Ô∏è'+v.pulse+'bpm':''}${v.bp_systolic?' ü©∏'+v.bp_systolic+'/'+(v.bp_diastolic||'?'):''}${v.spo2?' O‚ÇÇ'+v.spo2+'%':''}
        </div>
      </div>
      <div class="row-meta"><span style="font-size:0.72rem;color:var(--text-3);font-family:monospace">${fmt(v.signs_date)}</span></div>
    </div>`).join('');
}

async function loadProfile() {
  if (!state.employee) { document.getElementById('profile-container').innerHTML = empty('Employee record not linked.'); return; }
  const e = state.employee;
  document.getElementById('profile-container').innerHTML = `
    <div class="profile-grid">
      <div class="profile-field"><div class="pf-label">Employee ID</div><div class="pf-value">${e.name}</div></div>
      <div class="profile-field"><div class="pf-label">Full Name</div><div class="pf-value">${e.employee_name||'‚Äî'}</div></div>
      <div class="profile-field"><div class="pf-label">Designation</div><div class="pf-value">${e.designation||'‚Äî'}</div></div>
      <div class="profile-field"><div class="pf-label">Department</div><div class="pf-value">${e.department||'‚Äî'}</div></div>
      <div class="profile-field"><div class="pf-label">Mobile</div><div class="pf-value">${e.cell_number||'‚Äî'}</div></div>
      <div class="profile-field"><div class="pf-label">Email</div><div class="pf-value">${e.personal_email||state.user||'‚Äî'}</div></div>
    </div>`;
}

async function loadVitals() {
  const data = await api('Vital Signs',{fields:['name','patient','signs_date','temperature','pulse','bp_systolic','bp_diastolic','spo2','respiratory_rate'],order_by:'signs_date desc',limit:50});
  document.getElementById('count-vitals').textContent = data?.length||0;
  document.getElementById('list-vitals').innerHTML = data?.length ? renderVitalRows(data) : empty();
}

async function loadPatients() {
  const data = await api('Patient',{fields:['name','patient_name','sex','blood_group','mobile'],order_by:'patient_name asc',limit:100});
  document.getElementById('count-patients').textContent = data?.length||0;
  document.getElementById('list-patients').innerHTML = data?.length ? data.map(p=>`
    <div class="data-row" onclick="openERP('/app/patient/${p.name}')">
      <div class="row-main"><div class="row-title">${p.patient_name||p.name}</div><div class="row-sub">${p.name} ¬∑ ${p.sex||'‚Äî'} ¬∑ ${p.blood_group||'‚Äî'}</div></div>
      <div class="row-meta"><span style="font-size:0.78rem;color:var(--text-3)">${p.mobile||'‚Äî'}</span></div>
    </div>`).join('') : empty();
}

async function loadInpatient() {
  const data = await api('Inpatient Record',{fields:['name','patient_name','patient','status','admitted_datetime','expected_discharge'],order_by:'admitted_datetime desc',limit:50});
  document.getElementById('count-inpatient').textContent = data?.length||0;
  document.getElementById('list-inpatient').innerHTML = data?.length ? data.map(r=>`
    <div class="data-row" onclick="openERP('/app/inpatient-record/${r.name}')">
      <div class="row-main"><div class="row-title">${r.patient_name||r.patient||r.name}</div><div class="row-sub">Admitted: ${fmt(r.admitted_datetime)} ¬∑ Discharge: ${fmt(r.expected_discharge)}</div></div>
      <div class="row-meta"><span class="badge ${badgeClass(r.status)}">${r.status||'‚Äî'}</span></div>
    </div>`).join('') : empty();
}

async function loadNursingTasks() {
  let html = empty('No nursing tasks found.');
  for (const dt of ['Nursing Task','Patient Task','Clinical Note']) {
    const data = await api(dt,{fields:['name','patient','status','creation'],order_by:'creation desc',limit:50});
    if (data?.length) {
      html = data.map(t=>`
        <div class="data-row" onclick="openERP('/app/${dt.toLowerCase().replace(/ /g,'-')}/${t.name}')">
          <div class="row-main"><div class="row-title">${t.name}</div><div class="row-sub">${t.patient||'‚Äî'}</div></div>
          <div class="row-meta"><span class="badge ${badgeClass(t.status)}">${t.status||'‚Äî'}</span><span style="font-size:0.72rem;color:var(--text-3)">${fmt(t.creation)}</span></div>
        </div>`).join('');
      document.getElementById('count-nursing-tasks').textContent = data.length;
      break;
    }
  }
  document.getElementById('list-nursing-tasks').innerHTML = html;
}

async function loadMedication() {
  const data = await api('Medication Request',{fields:['name','patient','status','medication','quantity','creation'],order_by:'creation desc',limit:50});
  document.getElementById('count-medication').textContent = data?.length||0;
  document.getElementById('list-medication').innerHTML = data?.length ? data.map(m=>`
    <div class="data-row" onclick="openERP('/app/medication-request/${m.name}')">
      <div class="row-main"><div class="row-title">${m.patient||m.name}</div><div class="row-sub">${m.medication||'‚Äî'} ¬∑ Qty: ${m.quantity||'‚Äî'}</div></div>
      <div class="row-meta"><span class="badge ${badgeClass(m.status)}">${m.status||'‚Äî'}</span><span style="font-size:0.72rem;color:var(--text-3)">${fmt(m.creation)}</span></div>
    </div>`).join('') : empty();
}

async function loadServiceReq() {
  const data = await api('Service Request',{fields:['name','patient','status','template_dt','ordered_by','creation'],order_by:'creation desc',limit:50});
  document.getElementById('count-service-req').textContent = data?.length||0;
  document.getElementById('list-service-req').innerHTML = data?.length ? data.map(r=>`
    <div class="data-row" onclick="openERP('/app/service-request/${r.name}')">
      <div class="row-main"><div class="row-title">${r.patient||r.name}</div><div class="row-sub">${r.template_dt||'‚Äî'} ¬∑ By: ${r.ordered_by||'‚Äî'}</div></div>
      <div class="row-meta"><span class="badge ${badgeClass(r.status)}">${r.status||'‚Äî'}</span><span style="font-size:0.72rem;color:var(--text-3)">${fmt(r.creation)}</span></div>
    </div>`).join('') : empty();
}

async function loadAttendance() {
  const filters = state.employee?[['employee','=',state.employee.name]]:[];
  const data = await api('Attendance',{filters,fields:['name','attendance_date','status','in_time','out_time'],order_by:'attendance_date desc',limit:30});
  document.getElementById('list-attendance').innerHTML = data?.length ? data.map(a=>`
    <div class="data-row" onclick="openERP('/app/attendance/${a.name}')">
      <div class="row-main"><div class="row-title">${fmt(a.attendance_date)}</div><div class="row-sub">${a.in_time||'‚Äî'} ‚Üí ${a.out_time||'‚Äî'}</div></div>
      <div class="row-meta"><span class="badge ${badgeClass(a.status)}">${a.status||'‚Äî'}</span></div>
    </div>`).join('') : empty();
}

async function loadLeave() {
  const filters = state.employee?[['employee','=',state.employee.name]]:[];
  const data = await api('Leave Application',{filters,fields:['name','leave_type','from_date','to_date','status'],order_by:'from_date desc',limit:20});
  document.getElementById('list-leave').innerHTML = data?.length ? data.map(l=>`
    <div class="data-row" onclick="openERP('/app/leave-application/${l.name}')">
      <div class="row-main"><div class="row-title">${l.leave_type||l.name}</div><div class="row-sub">${fmt(l.from_date)} ‚Üí ${fmt(l.to_date)}</div></div>
      <div class="row-meta"><span class="badge ${badgeClass(l.status)}">${l.status||'‚Äî'}</span></div>
    </div>`).join('') : empty();
}

async function loadPayroll() {
  const filters = state.employee?[['employee','=',state.employee.name]]:[];
  const data = await api('Salary Slip',{filters,fields:['name','posting_date','net_pay','status'],order_by:'posting_date desc',limit:12});
  document.getElementById('list-payroll').innerHTML = data?.length ? data.map(s=>`
    <div class="data-row" onclick="openERP('/app/salary-slip/${s.name}')">
      <div class="row-main"><div class="row-title">${fmt(s.posting_date)}</div><div class="row-sub">Net Pay: ‚Çπ${Number(s.net_pay||0).toLocaleString('en-IN')}</div></div>
      <div class="row-meta"><span class="badge ${badgeClass(s.status)}">${s.status||'‚Äî'}</span></div>
    </div>`).join('') : empty();
}

// Vitals quick entry
function searchPatientForVitals() {
  clearTimeout(vitalsPatientSearchTimer);
  vitalsPatientSearchTimer = setTimeout(async () => {
    const q = document.getElementById('vitals-patient-inp').value.trim();
    if (q.length < 2) { document.getElementById('vitals-patient-result').innerHTML=''; return; }
    const res = await api('Patient',{filters:[['patient_name','like','%'+q+'%']],fields:['name','patient_name'],limit:5});
    if (!res?.length) { document.getElementById('vitals-patient-result').innerHTML='<p style="font-size:0.8rem;color:var(--text-3);padding:0.5rem 0;">No patients found.</p>'; return; }
    document.getElementById('vitals-patient-result').innerHTML = `<div class="picker-list" style="margin:0.5rem 0;">` + res.map(p=>`<div class="picker-item" onclick="selectVitalsPatient('${p.name}','${p.patient_name}')">${p.patient_name}<div class="pid">${p.name}</div></div>`).join('') + `</div>`;
  }, 300);
}

function selectVitalsPatient(id, name) {
  vitalsPatient = id;
  document.getElementById('vitals-patient-inp').value = name+' ('+id+')';
  document.getElementById('vitals-patient-result').innerHTML = '';
}

async function saveVitals() {
  if (!vitalsPatient) { alert('Please select a patient first.'); return; }
  const body = {
    doctype: 'Vital Signs',
    patient: vitalsPatient,
    signs_date: new Date().toISOString().split('T')[0],
  };
  const fields = {temperature:'v-temp',pulse:'v-pulse',bp_systolic:'v-bp-sys',bp_diastolic:'v-bp-dia',spo2:'v-spo2',respiratory_rate:'v-rr',weight:'v-weight',height:'v-height'};
  for (const [k,id] of Object.entries(fields)) {
    const v = document.getElementById(id).value;
    if (v) body[k] = parseFloat(v);
  }
  try {
    const r = await fetch(`${BASE}/api/resource/Vital Signs`,{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
    const d = await r.json();
    if (d.data?.name) { alert('‚úÖ Vital signs saved: '+d.data.name); clearVitalsForm(); loadVitals(); }
    else { alert('Failed: '+(d.exc_type||JSON.stringify(d))); }
  } catch(e) { alert('Error: '+e.message); }
}

function clearVitalsForm() {
  ['v-temp','v-pulse','v-bp-sys','v-bp-dia','v-spo2','v-rr','v-weight','v-height'].forEach(id=>document.getElementById(id).value='');
  vitalsPatient = null;
  document.getElementById('vitals-patient-inp').value = '';
}

document.addEventListener('keydown', e => { if (e.key==='Enter' && document.getElementById('inp-pass')===document.activeElement) doLogin(); });
initSession();
</script>
</body>
</html>
