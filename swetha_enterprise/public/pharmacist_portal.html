<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pharmacist Portal â€” Rena Rehabilitation Centre</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --navy-900:#050d1a; --navy-800:#0a1628; --navy-700:#0d1f3c;
  --blue-500:#1a56db; --blue-400:#3b82f6; --blue-300:#60a5fa;
  --teal:#0d9488; --teal-light:#14b8a6; --teal-glow:rgba(13,148,136,.3);
  --accent:#0ea5e9;
  --success:#10b981; --warning:#f59e0b; --danger:#ef4444;
  --text-primary:#f0f6ff; --text-secondary:#94b8d8; --text-muted:#5a7fa8;
  --card-bg:rgba(13,31,60,.7); --card-border:rgba(59,130,246,.15); --sidebar-w:245px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--navy-900);color:var(--text-primary);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 80% 50% at 20% 10%,rgba(13,148,136,.1) 0%,transparent 60%),radial-gradient(ellipse 60% 40% at 80% 80%,rgba(14,165,233,.08) 0%,transparent 50%);pointer-events:none;z-index:0}
.sidebar{position:fixed;top:0;left:0;width:var(--sidebar-w);height:100vh;background:linear-gradient(180deg,var(--navy-800) 0%,var(--navy-900) 100%);border-right:1px solid var(--card-border);display:flex;flex-direction:column;z-index:100;overflow-y:auto}
.brand{padding:20px 16px 14px;border-bottom:1px solid var(--card-border)}
.brand-logo{width:40px;height:40px;background:linear-gradient(135deg,var(--teal),var(--teal-light));border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:8px;box-shadow:0 4px 16px var(--teal-glow)}
.brand-name{font-family:'Sora',sans-serif;font-size:12.5px;font-weight:600;line-height:1.3}
.brand-sub{font-size:11px;color:var(--text-muted);margin-top:2px}
.pharma-info{padding:12px 14px;margin:10px 7px;background:rgba(13,148,136,.1);border:1px solid rgba(13,148,136,.2);border-radius:9px}
.ph-avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#134e4a,var(--teal));display:flex;align-items:center;justify-content:center;font-size:16px;margin-bottom:6px}
.ph-name{font-family:'Sora',sans-serif;font-size:13px;font-weight:600}
.ph-role{font-size:11px;color:var(--teal-light);margin-top:2px;display:flex;align-items:center;gap:4px}
.nav-section{padding:7px 11px 3px;font-size:10px;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--text-muted)}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 14px 8px 17px;margin:1px 6px;border-radius:8px;cursor:pointer;font-size:13px;color:var(--text-secondary);transition:all .18s}
.nav-item:hover{background:rgba(59,130,246,.1);color:var(--text-primary)}
.nav-item.active{background:rgba(13,148,136,.15);color:var(--teal-light);border-left:2px solid var(--teal)}
.nav-item .icon{font-size:15px;width:18px;text-align:center}
.sidebar-footer{margin-top:auto;padding:10px 6px;border-top:1px solid var(--card-border)}
.main{margin-left:var(--sidebar-w);min-height:100vh;position:relative;z-index:1}
.topbar{position:sticky;top:0;background:rgba(5,13,26,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--card-border);padding:0 24px;height:56px;display:flex;align-items:center;justify-content:space-between;z-index:90}
.page-title{font-family:'Sora',sans-serif;font-size:16px;font-weight:600}
.content{padding:20px 24px}
.section{display:none}
.section.active{display:block;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.btn{display:inline-flex;align-items:center;gap:6px;padding:7px 13px;border-radius:8px;font-size:13px;font-weight:500;cursor:pointer;border:none;transition:all .18s;font-family:'DM Sans',sans-serif}
.btn-primary{background:var(--blue-500);color:white}
.btn-primary:hover{background:var(--blue-400);transform:translateY(-1px)}
.btn-teal{background:rgba(13,148,136,.2);color:var(--teal-light);border:1px solid rgba(13,148,136,.3)}
.btn-teal:hover{background:rgba(13,148,136,.35)}
.btn-ghost{background:transparent;color:var(--text-secondary);border:1px solid var(--card-border)}
.btn-ghost:hover{background:rgba(59,130,246,.1);color:var(--text-primary)}
.btn-danger{background:rgba(239,68,68,.15);color:var(--danger);border:1px solid rgba(239,68,68,.25)}
.btn-success{background:rgba(16,185,129,.15);color:var(--success);border:1px solid rgba(16,185,129,.25)}

/* POS LAYOUT */
.pos-layout{display:grid;grid-template-columns:1fr 320px;gap:16px;height:calc(100vh - 120px)}
.pos-left{overflow-y:auto;display:flex;flex-direction:column;gap:14px}
.pos-right{background:var(--card-bg);border:1px solid var(--card-border);border-radius:14px;display:flex;flex-direction:column;overflow:hidden}

/* PRODUCT SEARCH */
.product-search{display:flex;gap:10px;align-items:center;margin-bottom:12px}
.search-input{background:rgba(13,148,136,.08);border:1px solid rgba(13,148,136,.2);border-radius:9px;padding:9px 13px;color:var(--text-primary);font-size:13px;font-family:'DM Sans',sans-serif;outline:none;flex:1;transition:border-color .15s}
.search-input:focus{border-color:var(--teal);background:rgba(13,148,136,.12)}
.search-input::placeholder{color:var(--text-muted)}

/* PRODUCT GRID */
.product-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.product-card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:11px;padding:12px;cursor:pointer;transition:all .2s;position:relative}
.product-card:hover{border-color:var(--teal);transform:translateY(-1px);box-shadow:0 6px 20px rgba(13,148,136,.15)}
.product-card.out-of-stock{opacity:.45;cursor:not-allowed}
.prod-name{font-size:12.5px;font-weight:500;color:var(--text-primary);margin-bottom:4px;line-height:1.3}
.prod-price{font-family:'Sora',sans-serif;font-size:15px;font-weight:700;color:var(--teal-light)}
.prod-stock{font-size:10px;color:var(--text-muted);margin-top:3px;font-family:'DM Mono',monospace}
.prod-category{font-size:10px;padding:2px 6px;background:rgba(13,148,136,.15);color:var(--teal-light);border-radius:4px;display:inline-block;margin-bottom:5px}
.add-btn{position:absolute;top:8px;right:8px;background:rgba(13,148,136,.2);border:none;border-radius:6px;color:var(--teal-light);font-size:16px;width:26px;height:26px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s}
.add-btn:hover{background:rgba(13,148,136,.4)}

/* CART */
.cart-header{padding:14px 16px;border-bottom:1px solid var(--card-border);display:flex;align-items:center;justify-content:space-between}
.cart-title{font-family:'Sora',sans-serif;font-size:13px;font-weight:600}
.cart-items{flex:1;overflow-y:auto;padding:10px}
.cart-empty{display:flex;align-items:center;justify-content:center;height:100%;flex-direction:column;color:var(--text-muted);gap:8px;font-size:13px}
.cart-item{display:flex;align-items:center;gap:8px;padding:8px;background:rgba(13,148,136,.06);border:1px solid rgba(13,148,136,.12);border-radius:8px;margin-bottom:6px}
.cart-item-name{flex:1;font-size:12.5px;font-weight:500;color:var(--text-primary);line-height:1.3}
.cart-item-price{font-family:'DM Mono',monospace;font-size:12px;color:var(--teal-light);white-space:nowrap}
.qty-ctrl{display:flex;align-items:center;gap:5px}
.qty-btn{background:rgba(13,148,136,.2);border:none;border-radius:5px;color:var(--teal-light);width:22px;height:22px;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center}
.qty-btn:hover{background:rgba(13,148,136,.4)}
.qty-val{font-family:'DM Mono',monospace;font-size:12px;width:24px;text-align:center;color:var(--text-primary)}
.remove-btn{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:14px;padding:2px}
.remove-btn:hover{color:var(--danger)}
.cart-footer{padding:12px 14px;border-top:1px solid var(--card-border)}
.cart-totals{margin-bottom:12px}
.cart-total-row{display:flex;justify-content:space-between;font-size:12px;color:var(--text-secondary);margin-bottom:4px}
.cart-total-row.grand{font-size:15px;font-weight:700;color:var(--text-primary);font-family:'Sora',sans-serif;margin-top:6px;padding-top:6px;border-top:1px solid var(--card-border)}
.cart-total-row.grand .val{color:var(--teal-light)}
.customer-sel{width:100%;margin-bottom:10px;background:rgba(13,148,136,.08);border:1px solid rgba(13,148,136,.15);border-radius:8px;padding:7px 10px;color:var(--text-primary);font-size:12.5px;font-family:'DM Sans',sans-serif;outline:none}
.checkout-btn{width:100%;padding:11px;background:linear-gradient(135deg,var(--teal),var(--teal-light));border:none;border-radius:9px;color:white;font-size:14px;font-weight:600;font-family:'Sora',sans-serif;cursor:pointer;transition:all .2s;letter-spacing:.02em}
.checkout-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px var(--teal-glow)}
.checkout-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

/* GENERAL CARDS */
.card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:13px;backdrop-filter:blur(10px);overflow:hidden;margin-bottom:14px}
.card-header{padding:14px 18px;border-bottom:1px solid var(--card-border);display:flex;align-items:center;justify-content:space-between}
.card-title{font-family:'Sora',sans-serif;font-size:13.5px;font-weight:600}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:13px;margin-bottom:20px}
.stat-card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:12px;padding:16px;position:relative;overflow:hidden;backdrop-filter:blur(10px);transition:transform .2s}
.stat-card:hover{transform:translateY(-2px)}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--teal),var(--accent));opacity:.7}
.stat-icon{font-size:20px;margin-bottom:9px}
.stat-value{font-family:'Sora',sans-serif;font-size:24px;font-weight:700;line-height:1}
.stat-label{font-size:11.5px;color:var(--text-muted);margin-top:3px}
.data-table{width:100%;border-collapse:collapse}
.data-table th{padding:9px 14px;text-align:left;font-size:11px;font-weight:600;letter-spacing:.06em;text-transform:uppercase;color:var(--text-muted);background:rgba(26,86,219,.06);border-bottom:1px solid var(--card-border)}
.data-table td{padding:10px 14px;font-size:12.5px;color:var(--text-secondary);border-bottom:1px solid rgba(59,130,246,.06)}
.data-table tr:last-child td{border-bottom:none}
.data-table tr:hover td{background:rgba(13,148,136,.04)}
.data-table .primary{color:var(--text-primary);font-weight:500}
.pill{display:inline-block;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:500}
.pill-green{background:rgba(16,185,129,.15);color:var(--success)}
.pill-blue{background:rgba(59,130,246,.15);color:var(--blue-300)}
.pill-yellow{background:rgba(245,158,11,.15);color:var(--warning)}
.pill-teal{background:rgba(13,148,136,.15);color:var(--teal-light)}
.pill-red{background:rgba(239,68,68,.15);color:var(--danger)}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(5,13,26,.88);backdrop-filter:blur(6px);z-index:200;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:var(--navy-700);border:1px solid var(--card-border);border-radius:16px;width:520px;max-width:95vw;max-height:88vh;overflow-y:auto}
.modal-header{padding:18px 22px;border-bottom:1px solid var(--card-border);display:flex;align-items:center;justify-content:space-between}
.modal-title{font-family:'Sora',sans-serif;font-size:15px;font-weight:600}
.modal-close{background:none;border:none;color:var(--text-muted);font-size:18px;cursor:pointer;padding:2px 7px;border-radius:6px}
.modal-close:hover{background:rgba(239,68,68,.15);color:var(--danger)}
.modal-body{padding:22px}
.form-group{display:flex;flex-direction:column;gap:4px;margin-bottom:12px}
.form-label{font-size:11px;font-weight:600;letter-spacing:.05em;text-transform:uppercase;color:var(--text-muted)}
.form-input,.form-select{background:rgba(13,148,136,.06);border:1px solid rgba(13,148,136,.2);border-radius:8px;padding:8px 11px;color:var(--text-primary);font-size:13px;font-family:'DM Sans',sans-serif;outline:none;width:100%;transition:border-color .15s}
.form-input:focus,.form-select:focus{border-color:var(--teal)}
.form-select option{background:var(--navy-700)}
.numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:14px 0}
.nkey{padding:14px;background:rgba(13,148,136,.1);border:1px solid rgba(13,148,136,.2);border-radius:9px;font-size:16px;font-weight:600;font-family:'Sora',sans-serif;cursor:pointer;text-align:center;color:var(--text-primary);transition:all .15s}
.nkey:hover{background:rgba(13,148,136,.25);transform:translateY(-1px)}
.nkey.clear{color:var(--danger);background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.2)}
.nkey.ok{color:white;background:linear-gradient(135deg,var(--teal),var(--teal-light));border:none;grid-column:span 2}
.payment-display{background:rgba(13,148,136,.08);border:1px solid rgba(13,148,136,.2);border-radius:9px;padding:14px;text-align:center;margin-bottom:12px}
.payment-amount{font-family:'Sora',sans-serif;font-size:30px;font-weight:700;color:var(--teal-light)}
.payment-label{font-size:11px;color:var(--text-muted);margin-top:3px}
.loading{display:flex;align-items:center;justify-content:center;padding:34px;color:var(--text-muted);font-size:13px;gap:8px}
.spinner{width:15px;height:15px;border:2px solid var(--card-border);border-top-color:var(--teal);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.empty-state{text-align:center;padding:36px 20px;color:var(--text-muted)}
.empty-state .icon{font-size:32px;margin-bottom:9px;opacity:.5}
.empty-state p{font-size:13px}
.alert{padding:9px 12px;border-radius:8px;font-size:12px;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.alert-success{background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.25);color:var(--success)}
.alert-error{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.25);color:var(--danger)}
.recent-strip{display:flex;gap:8px;overflow-x:auto;padding-bottom:6px;margin-bottom:14px}
.recent-strip::-webkit-scrollbar{height:4px}
.recent-chip{flex-shrink:0;background:rgba(13,148,136,.1);border:1px solid rgba(13,148,136,.2);border-radius:8px;padding:8px 12px;cursor:pointer;transition:all .18s}
.recent-chip:hover{background:rgba(13,148,136,.25)}
.chip-id{font-family:'DM Mono',monospace;font-size:11px;color:var(--teal-light)}
.chip-amt{font-size:12px;font-weight:600;color:var(--text-primary);margin-top:2px}
.hr-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}
.hr-card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:11px;padding:14px;cursor:pointer;transition:all .2s}
.hr-card:hover{transform:translateY(-2px);border-color:var(--teal)}
.hr-card .hr-icon{font-size:20px;margin-bottom:6px}
.hr-card .hr-title{font-family:'Sora',sans-serif;font-size:12.5px;font-weight:600}
.hr-card .hr-sub{font-size:11.5px;color:var(--text-muted);margin-top:2px}
::-webkit-scrollbar{width:5px} ::-webkit-scrollbar-track{background:transparent} ::-webkit-scrollbar-thumb{background:#134e4a;border-radius:3px}
</style>
</head>
<body>

<aside class="sidebar">
  <div class="brand">
    <div class="brand-logo">ğŸ’Š</div>
    <div class="brand-name">Rena Rehabilitation</div>
    <div class="brand-sub">Pharmacist Portal</div>
  </div>

  <div class="pharma-info">
    <div class="ph-avatar">ğŸ‘¨â€ğŸ’¼</div>
    <div class="ph-name" id="pharmaName">Pharmacist</div>
    <div class="ph-role"><span style="width:6px;height:6px;border-radius:50%;background:var(--success);display:inline-block;"></span> Pharmacist</div>
  </div>

  <div class="nav-section">Overview</div>
  <div class="nav-item" onclick="showSection('dashboard')"><span class="icon">ğŸ“Š</span> Dashboard</div>

  <div class="nav-section">Sales</div>
  <div class="nav-item active" onclick="showSection('pos')"><span class="icon">ğŸ›’</span> POS / Billing</div>
  <div class="nav-item" onclick="showSection('orders')"><span class="icon">ğŸ§¾</span> Sales History</div>
  <div class="nav-item" onclick="showSection('medreq')"><span class="icon">ğŸ“œ</span> Medication Requests</div>

  <div class="nav-section">Pharma Operations & Records</div>
  <div class="nav-item" onclick="showSection('items')"><span class="icon">ğŸ“¦</span> Items / Medicines</div>
  <div class="nav-item" onclick="showSection('stock')"><span class="icon">ğŸ”„</span> Stock Entries</div>
  <div class="nav-item" onclick="showSection('warehouses')"><span class="icon">ğŸ¢</span> Warehouses</div>
  <div class="nav-item" onclick="showSection('medreq')"><span class="icon">ğŸ“œ</span> Medication Requests</div>
  <div class="nav-item" onclick="showSection('inpatient')"><span class="icon">ğŸ¥</span> Inpatient Records</div>

  <div class="nav-section">HR / Employment</div>
  <div class="nav-item" onclick="showSection('hr')"><span class="icon">ğŸ“</span> HR Portal</div>

  <div class="nav-section">Account</div>
  <div class="nav-item" onclick="showSection('profile')"><span class="icon">ğŸ‘¤</span> My Profile</div>

  <div class="sidebar-footer">
    <div class="nav-item" onclick="logout()" style="color:var(--danger)"><span class="icon">ğŸšª</span> Logout</div>
  </div>
</aside>

<main class="main">
  <div class="topbar">
    <div class="page-title" id="pageTitle">POS Billing</div>
    <div style="display:flex;gap:10px;align-items:center;">
      <span id="cartCountBadge" style="background:var(--teal);color:white;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;">0</span>
      <button class="btn btn-ghost" onclick="clearCart()">ğŸ—‘ Clear Cart</button>
    </div>
  </div>

  <div class="content">

    <!-- DASHBOARD -->
    <div id="s_dashboard" class="section">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-icon">ğŸ§¾</div><div class="stat-value" id="dToday">â€”</div><div class="stat-label">Today's Sales</div></div>
        <div class="stat-card"><div class="stat-icon">ğŸ’Š</div><div class="stat-value" id="dItems">â€”</div><div class="stat-label">Active Items</div></div>
        <div class="stat-card"><div class="stat-icon">ğŸ“‹</div><div class="stat-value" id="dPending">â€”</div><div class="stat-label">Pending Med Requests</div></div>
        <div class="stat-card"><div class="stat-icon">ğŸ¥</div><div class="stat-value" id="dInpatient">â€”</div><div class="stat-label">Inpatients</div></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div class="card">
          <div class="card-header"><span class="card-title">ğŸ§¾ Recent Invoices</span></div>
          <div id="dashInvoices"><div class="loading"><div class="spinner"></div></div></div>
        </div>
        <div class="card">
          <div class="card-header"><span class="card-title">ğŸ“‹ Pending Requests</span></div>
          <div id="dashMedReq"><div class="loading"><div class="spinner"></div></div></div>
        </div>
      </div>
    </div>

    <!-- POS SECTION -->
    <div id="s_pos" class="section active">
      <div id="recentStrip" style="display:none;">
        <div style="font-size:11px;text-transform:uppercase;letter-spacing:.06em;color:var(--text-muted);margin-bottom:6px;">Recent Orders</div>
        <div class="recent-strip" id="recentChips"></div>
      </div>

      <div class="pos-layout">
        <!-- LEFT: Products -->
        <div class="pos-left">
          <div class="product-search">
            <input type="text" class="search-input" id="productSearch" placeholder="ğŸ” Search medicines & items..." oninput="filterProducts(this.value)">
            <select class="form-select" id="catFilter" onchange="filterProducts(document.getElementById('productSearch').value)" style="width:160px;background:rgba(13,148,136,.08);border:1px solid rgba(13,148,136,.2);">
              <option value="">All Categories</option>
            </select>
          </div>
          <div class="product-grid" id="productGrid">
            <div style="grid-column:1/-1"><div class="loading"><div class="spinner"></div> Loading products...</div></div>
          </div>
        </div>

        <!-- RIGHT: Cart -->
        <div class="pos-right">
          <div class="cart-header">
            <div class="cart-title">ğŸ›’ Cart</div>
            <div style="font-size:11px;color:var(--text-muted);" id="cartItemCount">0 items</div>
          </div>

          <div style="padding:10px 12px;border-bottom:1px solid var(--card-border);">
            <select class="customer-sel" id="customerSel">
              <option value="">â€” Walk-in Customer â€”</option>
            </select>
          </div>

          <div class="cart-items" id="cartItems">
            <div class="cart-empty">
              <span style="font-size:28px;opacity:.4;">ğŸ›’</span>
              <span>Cart is empty</span>
            </div>
          </div>

          <div class="cart-footer">
            <div class="cart-totals">
              <div class="cart-total-row"><span>Subtotal</span><span class="val" id="cartSubtotal">â‚¹0.00</span></div>
              <div class="cart-total-row"><span>Tax (0%)</span><span>â‚¹0.00</span></div>
              <div class="cart-total-row grand"><span>Total</span><span class="val" id="cartTotal">â‚¹0.00</span></div>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="openPaymentModal()" disabled>Pay Now</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SALES HISTORY -->
    <div id="s_orders" class="section">
      <div class="card">
        <div class="card-header"><span class="card-title">ğŸ“¦ Sales History</span></div>
        <table class="data-table">
          <thead><tr><th>Invoice</th><th>Customer</th><th>Date</th><th>Amount</th><th>Outstanding</th><th>Status</th><th>Action</th></tr></thead>
          <tbody id="ordersTbody"><tr><td colspan="7"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- MEDICATION REQUESTS -->
    <div id="s_medreq" class="section">
      <div class="card">
        <div class="card-header"><span class="card-title">ğŸ“‹ Medication Requests</span></div>
        <table class="data-table">
          <thead><tr><th>ID</th><th>Patient</th><th>Medication</th><th>Dosage</th><th>Status</th><th>Date</th><th>Action</th></tr></thead>
          <tbody id="medreqTbody"><tr><td colspan="7"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- ITEMS -->
    <div id="s_items" class="section">
      <div class="card">
        <div class="card-header">
          <span class="card-title">ğŸ’Š Medicines & Items</span>
          <input type="text" class="search-input" placeholder="Search..." oninput="filterInventoryItems(this.value)" style="width:200px;">
        </div>
        <table class="data-table">
          <thead><tr><th>Item</th><th>Item Group</th><th>Rate</th><th>UOM</th><th>Stock</th><th>Status</th></tr></thead>
          <tbody id="itemsTbody"><tr><td colspan="6"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- STOCK -->
    <div id="s_stock" class="section">
      <div class="card">
        <div class="card-header"><span class="card-title">ğŸ“Š Stock Entries</span></div>
        <table class="data-table">
          <thead><tr><th>Entry</th><th>Type</th><th>Date</th><th>Status</th><th>Action</th></tr></thead>
          <tbody id="stockTbody"><tr><td colspan="5"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- WAREHOUSES -->
    <div id="s_warehouses" class="section">
      <div class="card">
        <div class="card-header"><span class="card-title">ğŸ­ Warehouses</span></div>
        <table class="data-table">
          <thead><tr><th>Warehouse</th><th>Company</th><th>Type</th><th>Status</th></tr></thead>
          <tbody id="whTbody"><tr><td colspan="4"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- HR -->
    <div id="s_hr" class="section">
      <div class="hr-cards">
        <div class="hr-card" onclick="loadAtt()"><div class="hr-icon">ğŸ•</div><div class="hr-title">Attendance</div><div class="hr-sub">Daily records</div></div>
        <div class="hr-card" onclick="loadLeave()"><div class="hr-icon">ğŸŒ´</div><div class="hr-title">Leave</div><div class="hr-sub">Applications</div></div>
        <div class="hr-card" onclick="loadPayroll()"><div class="hr-icon">ğŸ’°</div><div class="hr-title">Payroll</div><div class="hr-sub">Salary slips</div></div>
      </div>
      <div class="card">
        <div class="card-header"><span class="card-title" id="hrTitle">Select a section</span></div>
        <div id="hrBody"><div class="empty-state"><div class="icon">ğŸ“</div><p>Select a section above</p></div></div>
      </div>
    </div>

    <!-- INPATIENT RECORDS -->
    <div id="s_inpatient" class="section">
      <div class="card">
        <div class="card-header"><span class="card-title">ğŸ¥ Inpatient Records</span></div>
        <table class="data-table">
          <thead><tr><th>Patient</th><th>Ward/Bed</th><th>Admitted</th><th>Status</th><th>Action</th></tr></thead>
          <tbody id="inpatientTbody"><tr><td colspan="5"><div class="loading"><div class="spinner"></div></div></td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- MY PROFILE -->
    <div id="s_profile" class="section">
      <div class="card">
        <div class="card-header"><span class="card-title">ğŸ‘¤ My Profile</span></div>
        <div id="profileBody"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

  </div>
</main>

<!-- PAYMENT MODAL -->
<div class="modal-overlay" id="payModal">
  <div class="modal" style="width:480px;">
    <div class="modal-header">
      <div class="modal-title">ğŸ’³ Process Payment</div>
      <button class="modal-close" onclick="closeModal('payModal')">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="payAlert"></div>
      <div class="payment-display">
        <div class="payment-label">Total Amount Due</div>
        <div class="payment-amount" id="payDisplayAmt">â‚¹0.00</div>
      </div>
      <div class="form-group">
        <label class="form-label">Payment Mode</label>
        <select class="form-select" id="payMode">
          <option value="Cash">Cash</option>
          <option value="Card">Card</option>
          <option value="UPI">UPI</option>
          <option value="Cheque">Cheque</option>
        </select>
      </div>
      <div class="numpad" id="numpad">
        <div class="nkey" onclick="numpadPress('7')">7</div>
        <div class="nkey" onclick="numpadPress('8')">8</div>
        <div class="nkey" onclick="numpadPress('9')">9</div>
        <div class="nkey" onclick="numpadPress('4')">4</div>
        <div class="nkey" onclick="numpadPress('5')">5</div>
        <div class="nkey" onclick="numpadPress('6')">6</div>
        <div class="nkey" onclick="numpadPress('1')">1</div>
        <div class="nkey" onclick="numpadPress('2')">2</div>
        <div class="nkey" onclick="numpadPress('3')">3</div>
        <div class="nkey clear" onclick="numpadPress('C')">C</div>
        <div class="nkey" onclick="numpadPress('0')">0</div>
        <div class="nkey" onclick="numpadPress('.')">.</div>
        <div class="nkey ok" onclick="submitPayment()">âœ“ Confirm Payment</div>
      </div>
      <div style="font-size:12px;color:var(--text-muted);text-align:center;">Cash received: <span id="cashReceived" style="font-family:'DM Mono',monospace;color:var(--teal-light);">â€”</span></div>
    </div>
  </div>
</div>

<script>
const BASE='';
let products=[],cart=[],customers=[],allInventoryItems=[];
let cashInput='';

async function api(method,args={}){
  const r=await fetch(`${BASE}/api/method/${method}`,{method:'POST',headers:{'Content-Type':'application/json','X-Frappe-CSRF-Token':getCsrf()},body:JSON.stringify(args)});
  const d=await r.json(); if(d.exc) throw new Error(d.exc); return d.message??d;
}
async function getList(dt,fields=['name'],filters=[],limit=100,order='modified desc'){
  const p=new URLSearchParams({doctype:dt,fields:JSON.stringify(fields),filters:JSON.stringify(filters),limit_page_length:limit,order_by:order});
  const r=await fetch(`${BASE}/api/resource/${encodeURIComponent(dt)}?${p}`,{headers:{'X-Frappe-CSRF-Token':getCsrf()}});
  return (await r.json()).data||[];
}
function getCsrf(){
  if(typeof frappe!=='undefined'&&frappe.csrf_token) return frappe.csrf_token;
  return (document.cookie.match(/csrftoken=([^;]+)/)||[])[1]||'';
}

async function init(){
  try{
    const u=await api('frappe.auth.get_logged_user');
    const currentUser=(typeof u==='string'?u:u?.message)||null;
    if(!currentUser||currentUser==='Guest'){window.location.replace('/login');return;}
    document.getElementById('pharmaName').textContent=currentUser||'Pharmacist';
    window._pharmaUser=currentUser;
  }catch(e){window.location.replace('/login');return;}
  loadProducts();
  loadCustomers();
  loadRecentOrders();
  loadDashboard();
}

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById('s_'+id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  event?.currentTarget?.classList.add('active');
  const titles={dashboard:'Dashboard',pos:'POS / Billing',orders:'Sales History',medreq:'Medication Requests',items:'Items / Medicines',stock:'Stock Entries',warehouses:'Warehouses',inpatient:'Inpatient Records',hr:'HR / Employment',profile:'My Profile'};
  document.getElementById('pageTitle').textContent=titles[id]||id;
  const loaders={dashboard:loadDashboard,orders:loadOrders,medreq:loadMedReq,items:loadInventoryItems,stock:loadStock,warehouses:loadWarehouses,inpatient:loadInpatient,profile:loadPharmProfile};
  if(loaders[id]) loaders[id]();
}

async function loadDashboard(){
  try{
    const today=new Date().toISOString().split('T')[0];
    const [invToday,items,pending,inpatient]=await Promise.all([
      getList('Sales Invoice',['name','grand_total'],[['posting_date','=',today],['docstatus','=',1]],200),
      getList('Item',['name'],[['disabled','=',0]],1000),
      getList('Medication Request',['name'],[['status','=','Pending']],200),
      getList('Inpatient Record',['name'],[],100)
    ]);
    document.getElementById('dToday').textContent='â‚¹'+invToday.reduce((a,i)=>a+Number(i.grand_total||0),0).toLocaleString();
    document.getElementById('dItems').textContent=items.length;
    document.getElementById('dPending').textContent=pending.length;
    document.getElementById('dInpatient').textContent=inpatient.length;
  }catch(e){}
  // Recent invoices
  try{
    const inv=await getList('Sales Invoice',['name','customer_name','grand_total','posting_date','status'],[['docstatus','=',1]],8,'posting_date desc');
    document.getElementById('dashInvoices').innerHTML=inv.length?
      `<table class="data-table"><tbody>${inv.map(i=>`<tr>
        <td class="primary" style="font-family:'DM Mono',monospace;font-size:11px;">${i.name}</td>
        <td style="font-size:12px;">${i.customer_name||'Walk-in'}</td>
        <td style="font-family:'DM Mono',monospace;font-size:12px;color:var(--teal-light);">â‚¹${Number(i.grand_total||0).toLocaleString()}</td>
        <td><span class="pill ${pillCls(i.status)}">${i.status}</span></td>
      </tr>`).join('')}</tbody></table>`:
      emptyState('No invoices today');
  }catch(e){}
  // Pending med requests
  try{
    const reqs=await getList('Medication Request',['name','patient','medication','status'],[['status','=','Pending']],10);
    document.getElementById('dashMedReq').innerHTML=reqs.length?
      `<table class="data-table"><tbody>${reqs.map(r=>`<tr>
        <td class="primary" style="font-size:12px;">${r.patient||'â€”'}</td>
        <td style="font-size:12px;">${r.medication||'â€”'}</td>
        <td><span class="pill pill-yellow">Pending</span></td>
      </tr>`).join('')}</tbody></table>`:
      emptyState('No pending requests');
  }catch(e){}
}

async function loadInpatient(){
  const tbody=document.getElementById('inpatientTbody');
  try{
    const list=await getList('Inpatient Record',['name','patient','patient_name','admitted_datetime','status','bed'],[],100);
    if(!list.length){tbody.innerHTML=emptyRow(5,'No inpatient records');return;}
    tbody.innerHTML=list.map(r=>`<tr>
      <td class="primary">${r.patient_name||r.patient}</td>
      <td>${r.bed||'â€”'}</td>
      <td style="font-family:'DM Mono',monospace;font-size:12px;">${(r.admitted_datetime||'').substring(0,10)}</td>
      <td><span class="pill ${pillCls(r.status)}">${r.status||'Active'}</span></td>
      <td><a href="/healthcare/inpatient-record/${r.name}" target="_blank" class="btn btn-ghost" style="font-size:11px;padding:3px 9px;">View</a></td>
    </tr>`).join('');
  }catch(e){tbody.innerHTML=errRow(5,e.message);}
}

async function loadPharmProfile(){
  const el=document.getElementById('profileBody');
  el.innerHTML=`<div class="loading"><div class="spinner"></div></div>`;
  const rows=[
    ['ğŸ‘¤ Logged in as', window._pharmaUser||'â€”'],
    ['ğŸ¥ Role', 'Pharmacist'],
    ['ğŸŒ Portal', 'Rena Rehabilitation Centre'],
  ];
  el.innerHTML=`<table class="data-table" style="padding:16px;"><tbody>${rows.map(r=>`<tr>
    <td style="font-size:12px;color:var(--text-muted);width:160px;">${r[0]}</td>
    <td style="font-size:13px;font-weight:500;">${r[1]}</td>
  </tr>`).join('')}</tbody></table>`;
}

// â”€â”€â”€ PRODUCTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadProducts(){
  const grid=document.getElementById('productGrid');
  try{
    const items=await getList('Item',['name','item_name','item_code','standard_rate','item_group','disabled'],[['disabled','=',0]],200,'item_name asc');
    products=items;
    // Populate category filter
    const cats=[...new Set(items.map(i=>i.item_group).filter(Boolean))];
    const sel=document.getElementById('catFilter');
    cats.forEach(c=>{const o=document.createElement('option');o.value=c;o.textContent=c;sel.appendChild(o);});
    renderProducts(items);
  }catch(e){grid.innerHTML=`<div style="grid-column:1/-1"><div class="alert alert-error">âš  ${e.message}</div></div>`;}
}

function renderProducts(list){
  const grid=document.getElementById('productGrid');
  if(!list.length){grid.innerHTML=`<div style="grid-column:1/-1"><div class="empty-state"><div class="icon">ğŸ’Š</div><p>No items found</p></div></div>`;return;}
  grid.innerHTML=list.map(p=>`
    <div class="product-card${p.disabled?'':''}" onclick="addToCart('${p.name}','${escJs(p.item_name||p.name)}',${p.standard_rate||0})">
      <div>
        ${p.item_group?`<div class="prod-category">${p.item_group}</div>`:''}
        <div class="prod-name">${p.item_name||p.name}</div>
        <div class="prod-price">â‚¹${Number(p.standard_rate||0).toFixed(2)}</div>
        <div class="prod-stock">Code: ${p.item_code||p.name}</div>
      </div>
      <button class="add-btn" onclick="event.stopPropagation();addToCart('${p.name}','${escJs(p.item_name||p.name)}',${p.standard_rate||0})">+</button>
    </div>`).join('');
}

function filterProducts(q){
  const cat=document.getElementById('catFilter').value;
  let list=products;
  if(cat) list=list.filter(p=>p.item_group===cat);
  if(q) list=list.filter(p=>(p.item_name||p.name).toLowerCase().includes(q.toLowerCase())||(p.item_code||'').toLowerCase().includes(q.toLowerCase()));
  renderProducts(list);
}

// â”€â”€â”€ CART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addToCart(id,name,price){
  const existing=cart.find(c=>c.id===id);
  if(existing) existing.qty++;
  else cart.push({id,name,price:parseFloat(price)||0,qty:1});
  renderCart();
}

function renderCart(){
  const el=document.getElementById('cartItems');
  document.getElementById('cartItemCount').textContent=`${cart.reduce((a,c)=>a+c.qty,0)} items`;
  document.getElementById('cartCountBadge').textContent=cart.length;

  if(!cart.length){
    el.innerHTML=`<div class="cart-empty"><span style="font-size:28px;opacity:.4;">ğŸ›’</span><span>Cart is empty</span></div>`;
    document.getElementById('checkoutBtn').disabled=true;
    updateTotals(); return;
  }

  el.innerHTML=cart.map((c,i)=>`
    <div class="cart-item">
      <div class="cart-item-name">${c.name}</div>
      <div class="qty-ctrl">
        <button class="qty-btn" onclick="changeQty(${i},-1)">âˆ’</button>
        <span class="qty-val">${c.qty}</span>
        <button class="qty-btn" onclick="changeQty(${i},1)">+</button>
      </div>
      <div class="cart-item-price">â‚¹${(c.price*c.qty).toFixed(2)}</div>
      <button class="remove-btn" onclick="removeFromCart(${i})">âœ•</button>
    </div>`).join('');

  document.getElementById('checkoutBtn').disabled=false;
  updateTotals();
}

function changeQty(i,delta){
  cart[i].qty=Math.max(1,cart[i].qty+delta);
  renderCart();
}
function removeFromCart(i){cart.splice(i,1);renderCart();}
function clearCart(){cart=[];renderCart();}
function updateTotals(){
  const sub=cart.reduce((a,c)=>a+c.price*c.qty,0);
  document.getElementById('cartSubtotal').textContent=`â‚¹${sub.toFixed(2)}`;
  document.getElementById('cartTotal').textContent=`â‚¹${sub.toFixed(2)}`;
}
function getCartTotal(){return cart.reduce((a,c)=>a+c.price*c.qty,0);}

// â”€â”€â”€ CUSTOMERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadCustomers(){
  try{
    const list=await getList('Customer',['name','customer_name'],[],200);
    customers=list;
    const sel=document.getElementById('customerSel');
    list.forEach(c=>{const o=document.createElement('option');o.value=c.name;o.textContent=c.customer_name||c.name;sel.appendChild(o);});
  }catch(e){}
}

// â”€â”€â”€ RECENT ORDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadRecentOrders(){
  try{
    const list=await getList('Sales Invoice',['name','grand_total','posting_date'],[['docstatus','=',1]],8,'posting_date desc');
    if(!list.length) return;
    const strip=document.getElementById('recentChips');
    document.getElementById('recentStrip').style.display='block';
    strip.innerHTML=list.map(inv=>`
      <div class="recent-chip" onclick="viewInvoice('${inv.name}')">
        <div class="chip-id">${inv.name}</div>
        <div class="chip-amt">â‚¹${Number(inv.grand_total||0).toLocaleString()}</div>
      </div>`).join('');
  }catch(e){}
}

function viewInvoice(name){
  window.open(`/printview?doctype=Sales+Invoice&name=${name}&format=Standard`,'_blank');
}

// â”€â”€â”€ PAYMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openPaymentModal(){
  if(!cart.length) return;
  const total=getCartTotal();
  document.getElementById('payDisplayAmt').textContent=`â‚¹${total.toFixed(2)}`;
  document.getElementById('payAlert').innerHTML='';
  cashInput='';
  document.getElementById('cashReceived').textContent='â€”';
  document.getElementById('payModal').classList.add('open');
}

function numpadPress(k){
  if(k==='C'){cashInput='';document.getElementById('cashReceived').textContent='â€”';return;}
  cashInput+=k;
  document.getElementById('cashReceived').textContent=`â‚¹${cashInput}`;
}

async function submitPayment(){
  const alertEl=document.getElementById('payAlert');
  alertEl.innerHTML='';
  const customerVal=document.getElementById('customerSel').value;
  const payMode=document.getElementById('payMode').value;
  const total=getCartTotal();
  if(!cart.length){alertEl.innerHTML=`<div class="alert alert-error">âš  Cart is empty</div>`;return;}

  // Need a default walk-in customer if none selected
  let customer=customerVal||'';
  if(!customer){
    // Try to find or use 'Walk-in Customer'
    try{
      const existing=await getList('Customer',['name'],[['customer_name','like','%Walk%']],1);
      if(existing.length) customer=existing[0].name;
      else{
        // Create walk-in customer
        const c=await api('frappe.client.insert',{doc:{
          doctype:'Customer',customer_name:'Walk-in Customer',
          customer_type:'Individual',customer_group:'All Customer Groups',territory:'All Territories'
        }});
        customer=c.name;
      }
    }catch(e){ customer='Walk-in Customer'; }
  }

  try{
    const items=cart.map(c=>({item_code:c.id,item_name:c.name,qty:c.qty,rate:c.price,amount:c.price*c.qty}));
    // Step 1: Insert
    const inv=await api('frappe.client.insert',{doc:{
      doctype:'Sales Invoice',
      customer,
      is_pos:1,
      items,
      payments:[{mode_of_payment:payMode,amount:total}]
    }});
    // Step 2: Submit
    await api('frappe.client.submit',{doc:{doctype:'Sales Invoice',name:inv.name}});
    alertEl.innerHTML=`<div class="alert alert-success">âœ“ Invoice ${inv.name} created & submitted!</div>`;
    cart=[];
    setTimeout(()=>{closeModal('payModal');renderCart();loadRecentOrders();},1800);
  }catch(e){
    alertEl.innerHTML=`<div class="alert alert-error">âš  ${e.message||'Invoice creation failed'}</div>`;
  }
}

// â”€â”€â”€ SALES HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadOrders(){
  const tbody=document.getElementById('ordersTbody');
  try{
    const list=await getList('Sales Invoice',['name','customer_name','posting_date','grand_total','outstanding_amount','status'],[['docstatus','=',1]],100,'posting_date desc');
    if(!list.length){tbody.innerHTML=emptyRow(7,'No sales history');return;}
    tbody.innerHTML=list.map(inv=>`<tr>
      <td class="primary" style="font-family:'DM Mono',monospace;font-size:12px;">${inv.name}</td>
      <td>${inv.customer_name||'Walk-in'}</td>
      <td>${inv.posting_date||'â€”'}</td>
      <td style="font-family:'DM Mono',monospace;">â‚¹${Number(inv.grand_total||0).toLocaleString()}</td>
      <td style="color:${parseFloat(inv.outstanding_amount)>0?'var(--warning)':'var(--success)'};font-family:'DM Mono',monospace;">â‚¹${Number(inv.outstanding_amount||0).toLocaleString()}</td>
      <td><span class="pill ${pillCls(inv.status)}">${inv.status}</span></td>
      <td><button class="btn btn-ghost" style="font-size:11px;padding:3px 9px;" onclick="viewInvoice('${inv.name}')">ğŸ–¨ Print</button></td>
    </tr>`).join('');
  }catch(e){tbody.innerHTML=errRow(7,e.message);}
}

// â”€â”€â”€ MED REQUESTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadMedReq(){
  const tbody=document.getElementById('medreqTbody');
  try{
    const list=await getList('Medication Request',['name','patient','medication','dosage','status','modified'],[],100);
    if(!list.length){tbody.innerHTML=emptyRow(7,'No medication requests');return;}
    tbody.innerHTML=list.map(m=>`<tr>
      <td class="primary" style="font-family:'DM Mono',monospace;font-size:12px;">${m.name}</td>
      <td>${m.patient||'â€”'}</td>
      <td>${m.medication||'â€”'}</td>
      <td>${m.dosage||'â€”'}</td>
      <td><span class="pill ${pillCls(m.status)}">${m.status||'Pending'}</span></td>
      <td style="font-size:12px;">${(m.modified||'').substring(0,10)}</td>
      <td><button class="btn btn-ghost" style="font-size:11px;padding:3px 9px;">Process</button></td>
    </tr>`).join('');
  }catch(e){tbody.innerHTML=errRow(7,e.message);}
}

// â”€â”€â”€ INVENTORY ITEMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadInventoryItems(){
  const tbody=document.getElementById('itemsTbody');
  try{
    const list=await getList('Item',['name','item_name','item_group','standard_rate','stock_uom','disabled'],[],300,'item_name asc');
    allInventoryItems=list;
    renderInvItems(list);
  }catch(e){tbody.innerHTML=errRow(6,e.message);}
}
function renderInvItems(list){
  const tbody=document.getElementById('itemsTbody');
  if(!list.length){tbody.innerHTML=emptyRow(6,'No items found');return;}
  tbody.innerHTML=list.map(item=>`<tr>
    <td class="primary">${item.item_name||item.name}</td>
    <td>${item.item_group||'â€”'}</td>
    <td style="font-family:'DM Mono',monospace;">â‚¹${Number(item.standard_rate||0).toFixed(2)}</td>
    <td>${item.stock_uom||'â€”'}</td>
    <td>â€”</td>
    <td><span class="pill ${item.disabled?'pill-red':'pill-green'}">${item.disabled?'Disabled':'Active'}</span></td>
  </tr>`).join('');
}
function filterInventoryItems(q){
  if(!q){renderInvItems(allInventoryItems);return;}
  renderInvItems(allInventoryItems.filter(i=>(i.item_name||i.name||'').toLowerCase().includes(q.toLowerCase())));
}

// â”€â”€â”€ STOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadStock(){
  const tbody=document.getElementById('stockTbody');
  try{
    const list=await getList('Stock Entry',['name','stock_entry_type','posting_date','docstatus'],[],100,'posting_date desc');
    if(!list.length){tbody.innerHTML=emptyRow(5,'No stock entries');return;}
    tbody.innerHTML=list.map(s=>`<tr>
      <td class="primary" style="font-family:'DM Mono',monospace;font-size:12px;">${s.name}</td>
      <td>${s.stock_entry_type||'â€”'}</td>
      <td>${s.posting_date||'â€”'}</td>
      <td><span class="pill ${s.docstatus==1?'pill-teal':'pill-yellow'}">${s.docstatus==1?'Submitted':'Draft'}</span></td>
      <td><a href="/stock/stock-entry/${s.name}" target="_blank" class="btn btn-ghost" style="font-size:11px;padding:3px 8px;">View</a></td>
    </tr>`).join('');
  }catch(e){tbody.innerHTML=errRow(5,e.message);}
}

// â”€â”€â”€ WAREHOUSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadWarehouses(){
  const tbody=document.getElementById('whTbody');
  try{
    const list=await getList('Warehouse',['name','company','warehouse_type','disabled'],[],100);
    if(!list.length){tbody.innerHTML=emptyRow(4,'No warehouses');return;}
    tbody.innerHTML=list.map(w=>`<tr>
      <td class="primary">${w.name}</td>
      <td>${w.company||'â€”'}</td>
      <td>${w.warehouse_type||'â€”'}</td>
      <td><span class="pill ${w.disabled?'pill-red':'pill-green'}">${w.disabled?'Disabled':'Active'}</span></td>
    </tr>`).join('');
  }catch(e){tbody.innerHTML=errRow(4,e.message);}
}

// â”€â”€â”€ HR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAtt(){
  document.getElementById('hrTitle').textContent='ğŸ• Attendance';
  document.getElementById('hrBody').innerHTML=`<div class="loading"><div class="spinner"></div></div>`;
  try{
    const list=await getList('Attendance',['name','attendance_date','employee_name','status'],[],30,'attendance_date desc');
    if(!list.length){document.getElementById('hrBody').innerHTML=emptyState('No attendance records');return;}
    document.getElementById('hrBody').innerHTML=`<table class="data-table"><thead><tr><th>Date</th><th>Employee</th><th>Status</th></tr></thead><tbody>${list.map(a=>`<tr><td>${a.attendance_date}</td><td>${a.employee_name||'â€”'}</td><td><span class="pill ${pillCls(a.status)}">${a.status}</span></td></tr>`).join('')}</tbody></table>`;
  }catch(e){document.getElementById('hrBody').innerHTML=`<div class="alert alert-error">âš  ${e.message}</div>`;}
}
async function loadLeave(){
  document.getElementById('hrTitle').textContent='ğŸŒ´ Leave';
  document.getElementById('hrBody').innerHTML=`<div class="loading"><div class="spinner"></div></div>`;
  try{
    const list=await getList('Leave Application',['name','employee_name','leave_type','from_date','to_date','status'],[],30,'from_date desc');
    if(!list.length){document.getElementById('hrBody').innerHTML=emptyState('No leave applications');return;}
    document.getElementById('hrBody').innerHTML=`<table class="data-table"><thead><tr><th>Employee</th><th>Type</th><th>From</th><th>To</th><th>Status</th></tr></thead><tbody>${list.map(l=>`<tr><td>${l.employee_name||'â€”'}</td><td>${l.leave_type}</td><td>${l.from_date}</td><td>${l.to_date}</td><td><span class="pill ${pillCls(l.status)}">${l.status}</span></td></tr>`).join('')}</tbody></table>`;
  }catch(e){document.getElementById('hrBody').innerHTML=`<div class="alert alert-error">âš  ${e.message}</div>`;}
}
async function loadPayroll(){
  document.getElementById('hrTitle').textContent='ğŸ’° Payroll';
  document.getElementById('hrBody').innerHTML=`<div class="loading"><div class="spinner"></div></div>`;
  try{
    const list=await getList('Salary Slip',['name','employee_name','start_date','end_date','net_pay','status'],[],24,'start_date desc');
    if(!list.length){document.getElementById('hrBody').innerHTML=emptyState('No salary slips');return;}
    document.getElementById('hrBody').innerHTML=`<table class="data-table"><thead><tr><th>Employee</th><th>Period</th><th>Net Pay</th><th>Status</th><th>Print</th></tr></thead><tbody>${list.map(s=>`<tr><td>${s.employee_name||'â€”'}</td><td>${s.start_date} â†’ ${s.end_date}</td><td style="font-family:'DM Mono',monospace;">â‚¹${Number(s.net_pay||0).toLocaleString()}</td><td><span class="pill ${pillCls(s.status)}">${s.status}</span></td><td><a href="/printview?doctype=Salary+Slip&name=${s.name}&format=Standard" target="_blank" class="btn btn-ghost" style="font-size:11px;padding:3px 8px;">Print</a></td></tr>`).join('')}</tbody></table>`;
  }catch(e){document.getElementById('hrBody').innerHTML=`<div class="alert alert-error">âš  ${e.message}</div>`;}
}

function pillCls(s){s=(s||'').toLowerCase();if(['paid','active','open','present','submitted'].some(v=>s.includes(v)))return 'pill-green';if(['pending','draft'].some(v=>s.includes(v)))return 'pill-yellow';if(['cancel','absent'].some(v=>s.includes(v)))return 'pill-red';return 'pill-teal';}
function errRow(c,m){return `<tr><td colspan="${c}"><div class="alert alert-error">âš  ${m}</div></td></tr>`;}
function emptyRow(c,m){return `<tr><td colspan="${c}"><div class="empty-state"><div class="icon">ğŸ“­</div><p>${m}</p></div></td></tr>`;}
function emptyState(m){return `<div class="empty-state"><div class="icon">ğŸ“­</div><p>${m}</p></div>`;}
function escJs(s){return (s||'').replace(/'/g,"\\'");}
function closeModal(id){document.getElementById(id).classList.remove('open');}
document.querySelectorAll('.modal-overlay').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));
async function logout(){
  try{
    await fetch(`${BASE}/api/method/frappe.auth.logout`,{method:'POST',headers:{'Content-Type':'application/json','X-Frappe-CSRF-Token':getCsrf()},body:JSON.stringify({})});
  }catch(e){}
  localStorage.clear();
  window.location.replace('/login');
}

init();
</script>
</body>
</html>
